<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="google-site-verification" content="21A3vpTGh97_AfzsV2BpLfz9fINsmm0ejFst-GwTjtw" />
    <link rel="icon" type="image/x-icon" href="/img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.simplecss.org/simple.min.css">
    <title>Measure. Testing Analytics Stuff</title>
    <script>
      // User ID handling
      const characters ='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
      function generateString(length) {
        let result = '';
        const charactersLength = characters.length;
        for ( let i = 0; i < length; i++ ) {
          result += characters.charAt(Math.floor(Math.random() * charactersLength));
        }
        return result;
      }
      var userID = generateString(15);
    
      // dataLayer 
      window.dataLayer = window.dataLayer || [];
    </script>
    
    <script src="https://cdn.amplitude.com/libs/analytics-browser-gtm-wrapper-3.15.0.js.br"></script>
    <script>
     // config values
      var ampAPIkey = '57b4b0482120f879aa7ee4d34d7cfd72';
      var instanceName = 'allAmp';
      var ampUserID = userID;
      var ampOptions = {
        autocapture: {
          attribution: {
            resetSessionOnNewCampaign: true,
          },
          sessions: true,
          pageViews: false,
          formInteractions: false,
          fileDownloads: false,
          elementInteractions: false,
        }
      };
    
      // Amp init  
      amplitudeGTM.createInstance(instanceName).init(ampAPIkey, ampUserID, ampOptions).promise.then(function(result){
        console.log('Amp GTM initializated');
    
        // semd Amp IDs to dataLayer
        window.dataLayer.push({
          event: 'ampSDKinit',
          ampData: {
            sessionID: amplitudeGTM._iq[instanceName].getSessionId(),
            deviceID: amplitudeGTM._iq[instanceName].getDeviceId(),
            userID: amplitudeGTM._iq[instanceName].getUserId(),
          }
        }); 
        console.table(dataLayer[0]);

        // $identify User Properties
        var identifyEvent = new amplitudeGTM._iq[instanceName].identify();
        identifyEvent.set('user_is_logged', 'yes'); 
        identifyEvent.set('user_type', 'premium');
        identifyEvent.set('user_behaviour', 'no conversion yet');
        amplitudeGTM._iq[instanceName].identify(identifyEvent); 

        // page_view        
        var eventData = {
          name: 'page_view',
          properties: {
            page_url: document.location.hostname+document.location.pathname,
            page_hostname: document.location.hostname,
            page_path: document.location.pathname,
            page_query: (document.location.search.includes('?')) ? document.location.search.split('?')[1] : undefined,
            page_fragment: (document.location.hash.includes('#')) ? document.location.hash.split('#')[1] : undefined,
            page_title: document.title
          }
        };
        amplitudeGTM._iq[instanceName].track(eventData.name, eventData.properties);

      });
    </script>
  </head>
  <body>
    <header>
      <h3>Amplitude Web. Option 6</h3>
      <h4>GTM + Browser SDK in GTM HTML tag. With instance Name</h4>
    </header>
    <main>
      <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Fusce nec viverra neque. Curabitur finibus porttitor quam, id dignissim massa mattis eu. Suspendisse dapibus nunc vel erat cursus efficitur. Aliquam ultricies eros eget urna ultricies.</p>
      <pre id="code"></pre>
      <p>Aliquam pellentesque eros vel mauris scelerisque, in placerat nulla suscipit. Curabitur pulvinar congue arcu vitae finibus. Vestibulum suscipit magna et sem varius sagittis. Nullam luctus congue felis at ultrices. Pellentesque at velit sed</p>
      <img alt="A dog on an iPad" src="/img/analytics-debugger-ducky.jpg" />
      <p>Phasellus ut cursus tellus. Morbi ac magna ut magna fermentum tincidunt. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse feugiat, ante in gravida tristique, ipsum ante dapibus orci, non fermentum mi velit id lacus.</p>
    </main>
    <footer>
      <div><a href="https://www.linkedin.com/in/anilopez/">Ani Lopez</a></div>
    </footer>
    <script>
      // display user ID
      document.getElementById('code').innerHTML = "User ID: " + userID;
    </script>
  </body>
</html>